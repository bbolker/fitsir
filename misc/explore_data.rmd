---
title: "Data"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r pkgs}
library(devtools)
load_all("..")
```

## Ebola

I got the data from [here](https://github.com/cmrivers/ebola). [Here](http://currents.plos.org/outbreaks/article/obk-14-0036-early-epidemic-dynamics-of-the-west-african-2014-ebola-outbreak-estimates-derived-with-a-simple-two-parameter-model/)'s a paper that fitted IDEA model to the data.

```{r}
eboladf <- read.csv("country_timeseries.csv")
```

I'm going to try to fit curves to ebola epidemic data

```{r getLiberia}
tmpfun <- function(data = "Liberia",
                   fitfun = fitsir,
                   auto = FALSE,
                   plot.it = FALSE,
                   start.pars = NA){
    case <- paste0("Cases_", data)
    cumInc <- eboladf[,c("Day", case)]
    cumInc <- cumInc[!is.na(cumInc[,2]),]
    cumInc <- cumInc[nrow(cumInc):1,]
    tmp.t <- cumInc[-1,1]
    tmp.I <- diff(cumInc[,2])
    df <- data.frame(tvec = tmp.t, count = tmp.I)
    if(auto){
        start <- startfun(data = df, auto = TRUE, incidence = TRUE)
    }else{
        start <- startfun()
    }
    if(!is.na(start.pars)){
        start <- start.pars
    }
    f.i <- fitfun(df, incidence = TRUE, start = start)
    pars <- coef(f.i)
    print(summarize.pars(pars))
    if(plot.it){
        par(mfrow = c(1,2))
        plot(df, main = "Incidence")
        tpars <- trans.pars(pars)
        inc <- SIR.detsim(tmp.t, tpars, incidence = TRUE)
        lines(tmp.t, inc)
        plot(tmp.t, cumsum(df[,2]), main = "Cumulative incidence", ylab = "count")
        lines(tmp.t, cumsum(inc))
        par(mfrow = c(1,1))
    }
    return(f.i)
}

tmpfun(auto = TRUE, plot.it = TRUE)
tmpfun(data = "Guinea", auto = TRUE, plot.it = TRUE)
tmpfun(data = "SierraLeone", plot.it = TRUE) ##unable to fit...
```

## Flu (2009) in WSU

I got the data from [here](https://www.researchgate.net/profile/Elissa_Schwartz/publication/266951690_Pandemic_2009_H1N1_influenza_in_two_settings_in_a_small_community_The_workplace_and_the_university_campus/links/55382bfc0cf226723ab616e6.pdf). They use daily reports in other papers but they don't provide it so I'm just going to try with weekly reports to see if it works...

```{r fludata}
df.flu <- data.frame(
    tvec = c(1:16),
    count = c(73, 524, 569, 357, 149, 92, 53, 95, 56, 61, 94, 81, 41, 16, 12, 3))
plot(df.flu)
(fit1 <- fitsir(df.flu, incidence = TRUE))
(fit2 <- fitsir.optim(df.flu, incidence = TRUE, nll = TRUE))
lines(SIR.detsim(df.flu$tvec, trans.pars(coef(fit1)), incidence = TRUE))
lines(SIR.detsim(df.flu$tvec, trans.pars(coef(fit2)), incidence = TRUE), col = 2)

summarize.pars(coef(fit1))
summarize.pars(coef(fit2))
```

Data source says that $N$ is 18234. We don't get any values that are close... It makes sense that we get a bad fit because we're only given reports at every week. Also, they don't provide reportings of the new cases through out the whole week. They just give us new cases that were counted on the day.

## R0 package

This package has some public data: https://github.com/cran/R0

```{r}
library(R0)
data(Germany.1918)
g.inc <- check.incid(Germany.1918)$incid
t.germ <- 1:length(g.inc)
df.1918 <- data.frame(tvec = t.germ, count = g.inc)
(fit.germ1 <- fitsir(df.1918, incidence = TRUE))
(fit.germ2 <- fitsir.optim(df.1918, incidence = TRUE, nll = TRUE))
findSens(df.1918, coef(fit.germ2),plot.it = TRUE, incidence = TRUE, log = "y", nll = TRUE)
```

* This fit doesn't look very good along the tail
* Population size seems pretty bad too

```{r}
inc <- SIR.detsim(t.germ, trans.pars(coef(fit.germ2)), incidence = TRUE)
plot(cumsum(g.inc))
lines(cumsum(inc))
```